# Spec 5.1: UI Framework Decision

## Objective
Evaluate and select the UI framework for the demo interface.

## Context
- Reference: PRD Section 12 (Open Questions), IMPLEMENTATION_PLAN.md Phase 5
- v1 used Gradio (caused event loop issues with asyncpg)
- v2 uses FastAPI with single event loop architecture
- Need framework that works well with async Python backends
- Demo UI is separate from API - can run independently

## Options Analysis

| Framework | Pros | Cons | Verdict |
|-----------|-------|-------|---------|
| **Gradio** | Quick ML demos, good chat components, built-in sharing | v1 had issues, event loop complexity, less customizable | ⚠️ Use with caution |
| **Streamlit** | Simple Python, fast prototyping, good data viz | Harder async integration, limited customization, rerun model | ✅ Good for MVP |
| **htmx + Flask/FastAPI** | Lightweight, full control, no JS needed | More manual work, less "out of box" components | ⚠️ More effort |
| **React + FastAPI** | Full control, modern, real-time capable | Requires JS expertise, more setup, separate frontend | ❌ Overkill for demo |

## Recommendation: Streamlit

**Rationale:**
1. **Async-safe**: Doesn't interfere with FastAPI's event loop (separate process)
2. **Fast development**: Pure Python, rapid iteration
3. **Good components**: Chat interface, metrics display, graph visualization
4. **API-first**: Calls FastAPI endpoints over HTTP - clean separation
5. **Demo-focused**: Perfect for showcasing capabilities without production complexity

**Architecture:**
```
┌─────────────────────────────────────────────────┐
│          Streamlit Demo UI (port 8501)          │
│  ┌─────────┐  ┌──────────┐  ┌─────────────┐   │
│  │  Chat   │  │  Graph   │  │   Metrics   │   │
│  │ Panel   │  │   Viz    │  │   Panel     │   │
│  └─────────┘  └──────────┘  └─────────────┘   │
└─────────────────────────────────────────────────┘
                    │ HTTP calls
                    ▼
┌─────────────────────────────────────────────────┐
│         FastAPI Backend (port 8000)             │
│  /sessions, /synthetic, /concepts, etc.         │
└─────────────────────────────────────────────────┘
```

## Output Files

### docs/ui-framework-decision.md
```markdown
# UI Framework Decision for Phase 5

## Decision: Streamlit

Date: 2025-01-21
Status: Approved

## Evaluation Criteria

1. **Async Safety**: Must not interfere with FastAPI event loop
2. **Development Speed**: Quick iteration for demo purposes
3. **Component Support**: Chat, graphs, metrics display
4. **API Integration**: Clean HTTP client to FastAPI backend
5. **Deployment**: Can run separately or alongside API

## Options Considered

### Gradio
- ✅ Quick setup, good chat components
- ❌ v1 had event loop issues with async operations
- ❌ Less customization control
- Verdict: Risk of repeating v1 problems

### Streamlit (Selected)
- ✅ Pure Python, fast development
- ✅ Good data viz components (Plotly, Altair)
- ✅ Separate process - no event loop conflicts
- ✅ Simple HTTP API calls to backend
- ⚠️ Rerun model can be slow for frequent updates
- Verdict: Best fit for demo UI MVP

### htmx
- ✅ Lightweight, no JS needed
- ❌ More manual work for components
- ❌ Slower development for demo
- Verdict: Good for production, overkill for demo

### React
- ✅ Full control, modern
- ❌ Requires JS expertise
- ❌ Separate frontend build step
- Verdict: Overkill for demo purposes

## Architecture

```
User Browser
    │
    ▼
Streamlit (localhost:8501)
    │ HTTP REST API calls
    ▼
FastAPI (localhost:8000)
    │
    ▼
Services + Database
```

## Implementation Plan

1. **Streamlit app** (`ui/streamlit_app.py`)
   - Chat interface using `st.chat_message`
   - Graph visualization using `st.plotly_chart`
   - Metrics panel using `st.metrics`
   - Session controls using `st.sidebar`

2. **API client** (`ui/api_client.py`)
   - Async HTTP client using `httpx`
   - Session management
   - Error handling

3. **Components** (`ui/components/`)
   - `chat.py` - Chat interface
   - `graph.py` - Graph visualization
   - `metrics.py` - Metrics display
   - `controls.py` - Session controls

## Dependencies

```
streamlit>=1.31.0
plotly>=5.18.0
networkx>=3.2
httpx>=0.26.0
```

## Next Steps

1. Install Streamlit: `pip install streamlit`
2. Create basic app: `ui/streamlit_app.py`
3. Test API connectivity
4. Build components incrementally
```

## Requirements
1. Document framework decision with rationale
2. Include architecture diagram
3. List dependencies
4. Define implementation approach

## Verification
```bash
# Verify decision document exists
cat docs/ui-framework-decision.md

# Verify Streamlit can be imported
python3 -c "import streamlit as st; print(st.__version__)"

# Verify basic app can run
echo "import streamlit as st; st.write('Hello')" > test_app.py && streamlit run test_app.py
```

## Success Criteria
- [ ] `docs/ui-framework-decision.md` created with decision rationale
- [ ] Streamlit selected as framework with documented reasoning
- [ ] Architecture diagram shows separation from FastAPI
- [ ] Dependencies listed for pyproject.toml
- [ ] Migration path documented if framework change needed later
