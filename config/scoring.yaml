# Two-tier scoring system configuration
#
# Tier 1: Hard constraints (boolean vetoes)
# - Early exit on first veto
# - No weights, all equal veto power
#
# Tier 2: Weighted additive scoring
# - Weights must sum to 1.0
# - Scores in range [0, 2] with 1.0 as neutral

scoring:
  # Tier 1 scorers (hard constraints)
  tier1_scorers:
    - id: knowledge_ceiling
      class: KnowledgeCeilingScorer
      enabled: true
      params:
        min_confidence: 0.5
        negative_patterns:
          - "don't know"
          - "not sure"
          - "never heard"
          - "no idea"
          - "unfamiliar"

    - id: element_exhausted
      class: ElementExhaustedScorer
      enabled: true
      params:
        max_mentions: 5
        lookback_window: 10

    - id: recent_redundancy
      class: RecentRedundancyScorer
      enabled: true
      params:
        similarity_threshold: 0.85
        lookback_window: 6
        method: "tfidf_cosine"  # jaccard, cosine, or embeddings

  # Tier 2 scorers (weighted additive)
  tier2_scorers:
    - id: coverage_gap
      class: CoverageGapScorer
      enabled: true
      weight: 0.20
      params:
        gap_types:
          - "unmentioned"
          - "no_reaction"
          - "no_comprehension"
          - "unconnected"
        boost_per_gap: 0.15

    - id: ambiguity
      class: AmbiguityScorer
      enabled: true
      weight: 0.15
      params:
        high_clarity_threshold: 0.8
        low_clarity_threshold: 0.5
        hedge_words:
          - "maybe"
          - "perhaps"
          - "possibly"
          - "sort of"
          - "kind of"
          - "i think"
          - "i guess"
          - "probably"
          - "not sure"

    - id: depth_breadth_balance
      class: DepthBreadthBalanceScorer
      enabled: true
      weight: 0.20
      params:
        target_ratio: 0.5  # 0.5 = balanced, 0.7 = depth-favoring
        low_breadth_threshold: 0.4
        high_breadth_threshold: 0.7
        low_depth_threshold: 2.0
        high_depth_threshold: 4.0

    - id: engagement
      class: EngagementScorer
      enabled: true
      weight: 0.15
      params:
        low_momentum_threshold: 30
        high_momentum_threshold: 100
        elaboration_markers:
          - "because"
          - "since"
          - "for example"
          - "specifically"
          - "such as"
          - "meaning"
        enthusiasm_markers:
          - "!"
          - "really"
          - "absolutely"
          - "love"
          - "great"
          - "perfect"

    - id: strategy_diversity
      class: StrategyDiversityScorer
      enabled: true
      weight: 0.15
      params:
        lookback_window: 5
        moderate_use_threshold: 2
        overuse_threshold: 3
        moderate_penalty: 0.8
        overuse_penalty: 0.6

    - id: novelty
      class: NoveltyScorer
      enabled: true
      weight: 0.15
      params:
        lookback_window: 8
        fresh_threshold: 1
        overdiscussed_threshold: 4
        fresh_boost: 1.2
        overdiscussed_penalty: 0.7

  # Validation rules
  validation:
    tier2_weights_must_sum_to: 1.0
    tolerance: 0.01
    require_at_least_one_tier1: false  # Tier 1 optional for now
    warn_if_tier1_veto_rate_exceeds: 0.8

# Strategy definitions
strategies:
  - id: deepen
    name: "Deepen Understanding"
    type_category: "depth"
    enabled: true
    prompt_hint: "Explore deeper into why this is important."

  - id: broaden
    name: "Explore Breadth"
    type_category: "breadth"
    enabled: true
    prompt_hint: "Expand to related areas or perspectives."

  - id: cover_element
    name: "Cover Stimulus Element"
    type_category: "coverage"
    enabled: true
    prompt_hint: "Ensure this element from the stimulus is addressed."

  - id: closing
    name: "Closing Interview"
    type_category: "closing"
    enabled: true
    prompt_hint: "Begin to wrap up the interview."
    min_turns: 8  # Minimum turns before closing is applicable

  - id: reflection
    name: "Reflection / Meta-Question"
    type_category: "reflection"
    enabled: true
    prompt_hint: "Ask a meta-question about the interview process."
    emergency_only: true  # Only when all else fails

  - id: bridge
    name: "Lateral Bridge to Peripheral"
    type_category: "peripheral"
    enabled: true
    prompt_hint: "Explicitly link to what was just said, then gently shift to a related but distinct area."

  - id: contrast
    name: "Introduce Counter-Example"
    type_category: "contrast"
    enabled: true
    prompt_hint: "Politely introduce a counter-example or opposite case to test boundaries."

  - id: ease
    name: "Ease / Rapport Repair"
    type_category: "interaction"
    enabled: true
    prompt_hint: "Simplify or soften the question, encourage participation."

  - id: synthesis
    name: "Summarise & Invite Extension"
    type_category: "transition"
    enabled: true
    prompt_hint: "Briefly summarise what you've heard and invite correction or addition."

# Phase profiles
phase_profiles:
  exploratory:
    deepen: 0.8
    broaden: 1.2
    cover_element: 1.1
    bridge: 0.2
    contrast: 0.0
    synthesis: 0.3
    closing: 0.0
    ease: 1.0
    reflection: 0.3

  focused:
    deepen: 1.3
    broaden: 0.4
    cover_element: 1.1
    bridge: 1.0
    contrast: 1.2
    synthesis: 0.7
    closing: 0.5
    ease: 1.0
    reflection: 0.7

  closing:
    deepen: 0.3
    broaden: 0.2
    cover_element: 0.5
    bridge: 0.3
    contrast: 0.5
    synthesis: 1.2
    closing: 1.5
    ease: 1.0
    reflection: 0.3

# Phase configuration
phase_config:
  exploratory:
    min_turns: 8
    max_turns: 20

  focused:
    min_turns: 5
    max_turns: null

  closing:
    min_turns: 15
    trigger_coverage: 0.95

# Strategy service configuration
strategy_service:
  alternatives_count: 3
  alternatives_min_score: 0.3
  exploratory_min_turns: 8
  focused_coverage_threshold: 0.6
  closing_min_turns: 20
  closing_coverage_threshold: 0.95

# Engine configuration
engine:
  veto_on_first: true  # Stop Tier 1 evaluation on first veto
  score_precision: 4   # Decimal places for score display
  alternatives_count: 3  # Number of alternatives to track
  alternatives_min_score: 0.3  # Minimum score for alternatives
