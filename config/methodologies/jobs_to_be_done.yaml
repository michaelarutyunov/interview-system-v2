# Jobs-to-be-Done Methodology Configuration
#
# JTBD explores what job users are trying to do, what triggers them,
# what alternatives they consider, and what obstacles they face.

method:
  name: jobs_to_be_done
  version: "2.0"
  goal: "Understand what jobs users are trying to accomplish and what motivates them"
  opening_bias: "Ask about a specific recent time they made a decision or change related to the topic."
  description: "Framework for understanding customer motivation and needs through job statements"

ontology:
  nodes:
    - name: job_statement
      level: 0
      terminal: false
      description: "Core functional or emotional job a customer is trying to accomplish"
      examples:
        - "get my daily caffeine fix"
        - "feel productive in the morning"
        - "socialize with colleagues"

    - name: job_context
      level: 0
      terminal: false
      description: "Situation or circumstances when the job arises"
      examples:
        - "when I'm rushing to work"
        - "when I'm working from home"
        - "when meeting clients"

    - name: job_trigger
      level: 0
      terminal: false
      description: "Event or stimulus that initiates the job"
      examples:
        - "feeling tired in the morning"
        - "anticipating a long meeting"
        - "hosting a gathering"

    - name: pain_point
      level: 0
      terminal: false
      description: "Obstacle or frustration in getting the job done"
      examples:
        - "coffee is too bitter"
        - "takes too long to prepare"
        - "upsets my stomach"

    - name: gain_point
      level: 0
      terminal: false
      description: "Desired outcome or benefit that makes the job worthwhile"
      examples:
        - "smooth, enjoyable taste"
        - "quick and convenient"
        - "feeling energized without jitters"

    - name: solution_approach
      level: 0
      terminal: false
      description: "Current or potential method for accomplishing the job"
      examples:
        - "using oat milk in coffee"
        - "buying coffee at a cafe"
        - "meal prepping"

    - name: emotional_job
      level: 1
      terminal: true
      description: "Emotional state or identity the customer seeks to achieve"
      examples:
        - "feel healthy and conscientious"
        - "project a professional image"
        - "treat myself with care"

    - name: social_job
      level: 1
      terminal: true
      description: "Social impression or relationship the customer wants to influence"
      examples:
        - "fit in with health-conscious peers"
        - "signal environmental values"
        - "avoid social awkwardness"

  edges:
    - name: occurs_in
      description: "Temporal or situational relationship between job and context"
      permitted_connections:
        - [job_statement, job_context]
        - [emotional_job, job_context]
        - [social_job, job_context]

    - name: triggered_by
      description: "Causal relationship where a stimulus initiates the job"
      permitted_connections:
        - [job_statement, job_trigger]
        - [emotional_job, job_trigger]
        - [social_job, job_trigger]

    - name: addresses
      description: "Solution approach resolves a pain point or enables a gain point"
      permitted_connections:
        - [solution_approach, pain_point]
        - [solution_approach, gain_point]
        - [job_statement, emotional_job]
        - [job_statement, social_job]

    - name: conflicts_with
      description: "Pain point that prevents the job from being done well"
      permitted_connections:
        - [solution_approach, pain_point]
        - [pain_point, job_statement]

    - name: enables
      description: "Gain point that makes the job more achievable or satisfying"
      permitted_connections:
        - [solution_approach, gain_point]
        - [gain_point, job_statement]

    - name: supports
      description: "Functional job that supports an emotional or social job"
      permitted_connections:
        - [job_statement, emotional_job]
        - [job_statement, social_job]

    - name: revises
      description: "Contradiction - newer belief or approach supersedes older one"
      permitted_connections:
        - ["*", "*"]

  extraction_guidelines:
    - "Listen for phrases indicating what the user is trying to accomplish ('I need to...', 'I want to...', 'The goal is...')"
    - "Identify the circumstances when the job becomes important ('when...', 'especially when...', 'in situations like...')"
    - "Extract pain points directly expressed ('frustrating that...', 'hate it when...', 'problem is...')"
    - "Extract gain points as positive outcomes ('love that...', 'great because...', 'important that...')"
    - "Distinguish between functional, emotional, and social jobs - often all three coexist"
    - "Map the current solution approach even if not explicitly stated"
    - "Connect jobs to their underlying emotional and social drivers"
    - "Look for trade-offs users make between competing jobs"

  relationship_examples:
    explicit_job_statement:
      description: "Direct statement of what needs to be accomplished"
      example: "I need something that wakes me up but doesn't make me jittery"
      extraction: "job_statement('wake up without jitters') → addresses → pain_point('caffeine jitters')"

    implicit_context:
      description: "Context revealed through situation description"
      example: "When I have 8am meetings, I can't wait in line at the cafe"
      extraction: "job_statement('get morning coffee') → occurs_in → job_context('early morning meetings')"

    pain_trigger_chain:
      description: "Trigger reveals the pain point and the job together"
      example: "Dairy makes me feel bloated, especially before presentations"
      extraction: "job_trigger('before presentations') → triggered_by → job_statement('feel comfortable') conflicts_with pain_point('dairy bloating')"

    functional_supports_emotional:
      description: "Functional choice enables emotional outcome"
      example: "I choose oat milk because it aligns with my values"
      extraction: "solution_approach('oat milk') → supports → emotional_job('feel environmentally responsible')"

  extractability_criteria:
    extractable_contains:
      - "Goals or objectives the user wants to achieve"
      - "Frustrations, pain points, or obstacles"
      - "Positive outcomes or benefits they value"
      - "Situational context (when, where, with whom)"
      - "Current solutions or workarounds"
      - "Emotions or social considerations related to choices"
    non_extractable_contains:
      - "Simple yes/no responses"
      - "Acknowledgments ('okay', 'I see', 'right')"
      - "Questions back to the interviewer"
      - "Purely factual product descriptions without user context"
      - "Irrelevant tangents"

signals:
  graph:
    - graph.node_count
    - graph.orphan_count
    - graph.max_depth

  llm:
    - llm.response_depth
    - llm.valence
    - llm.certainty
    - llm.specificity
    - llm.engagement
    # Note: llm.global_response_trend is session-scoped and managed separately

  temporal:
    - temporal.strategy_repetition_count
    - temporal.turns_since_strategy_change

  meta:
    - meta.interview_progress
    - meta.interview.phase

# Per-signal normalization: max_expected values for numeric signals.
# Numeric signal values are divided by max_expected and clipped to [0, 1].
# Signals not listed here fall back to the legacy /10 heuristic.
signal_norms:
  graph.node_count: 50       # JTBD interviews rarely exceed 50 nodes
  graph.orphan_count: 20     # Orphans typically < half of node_count
  graph.max_depth: 8         # JTBD chains can be deep (situation → outcome)
  temporal.strategy_repetition_count: 5  # Last 5 turns tracked
  temporal.turns_since_strategy_change: 5  # Practical max before forced pivot
  llm.response_depth: 5
  llm.valence: 5
  llm.certainty: 5
  llm.specificity: 5
  llm.engagement: 5

strategies:
  # Strategy 1: Explore the situation (elaboration)
  - name: explore_situation
    description: "Understand the context and circumstances around when jobs arise"
    signal_weights:
      # Global signals
      graph.node_count: -0.3
      llm.valence.mid: 0.5
      temporal.strategy_repetition_count: 0.4
      # Node-level signals (Phase 3)
      graph.node.focus_streak.none: 1.0  # Fresh nodes
      graph.node.yield_stagnation.false: 0.8  # Nodes that yield
      graph.node.exhausted.false: 0.7

  # Strategy 2: Probe alternatives (probing)
  - name: probe_alternatives
    description: "Discover what other solutions or approaches the user has considered"
    signal_weights:
      # Global signals
      llm.specificity.high: 0.4
      # Node-level signals (Phase 3)
      graph.node.is_orphan.true: 1.0  # Boost orphan nodes
      graph.node.edge_count.low: 0.5  # Less connected nodes
      graph.node.exhausted.false: 0.6

  # Strategy 3: Dig into motivation (laddering)
  - name: dig_motivation
    description: "Probe deeper with 'why' questions to uncover underlying functional and emotional jobs"
    signal_weights:
      # Global signals
      llm.response_depth.low: 0.7
      graph.max_depth: -0.4
      temporal.turns_since_strategy_change: 0.3
      # Node-level signals (Phase 3)
      graph.node.exhausted.false: 1.0  # Boost non-exhausted nodes
      graph.node.focus_streak.low: 0.5  # Prefer fresh nodes
      graph.node.exhaustion_score.low: 0.7  # Avoid exhausted nodes

  # Strategy 4: Validate outcome (validation)
  - name: validate_outcome
    description: "Confirm understanding and check if we've captured the most important aspects"
    signal_weights:
      # Global signals
      meta.interview_progress: 0.6
      graph.max_depth: 0.5
      llm.response_depth.high: 0.4
      # Uncertainty/hedging triggers (Phase 5)
      llm.certainty.low: 1.0  # Trigger on high uncertainty
      llm.certainty.mid: 0.7  # Trigger on medium uncertainty
      meta.node.opportunity.probe_deeper: 0.6  # Extraction opportunity
      # Node-level signals (Phase 3)
      graph.node.edge_count.high: 0.8  # Well-connected nodes
      graph.node.focus_streak.high: 0.5  # Often-focused nodes
      technique.node.strategy_repetition.low: 0.3  # Avoid overusing same strategy

  # Strategy 5: Revitalize engagement (elaboration) - Phase 5
  - name: revitalize
    description: "Shift to fresh topics when response trend shows fatigue or repeated shallow answers"
    signal_weights:
      # Fatigue detection triggers (Phase 5)
      llm.global_response_trend.fatigued: 1.0  # Trigger on fatigue
      llm.global_response_trend.shallowing: 0.5  # Prevent fatigue
      meta.node.opportunity.exhausted: 0.3  # Try exhausted nodes with new angle
      # Global signals
      graph.node_count: -0.3
      temporal.strategy_repetition_count: 0.4
      # Node-level signals (Phase 3)
      graph.node.focus_streak.none: 0.8  # Fresh nodes
      graph.node.exhausted.false: 0.5

  # Strategy 6: Uncover obstacles (probing)
  - name: uncover_obstacles
    description: "Identify pain points and frustrations that prevent jobs from being done well"
    signal_weights:
      # Global signals
      graph.orphan_count: 0.5
      llm.valence.low: 0.3
      temporal.turns_since_strategy_change: 0.2
      # Node-level signals (Phase 3)
      graph.node.is_orphan.true: 1.0  # Boost orphan nodes
      graph.node.yield_stagnation.false: 0.7  # Nodes that yield
      graph.node.exhausted.false: 0.6

phases:
  early:
    description: "Initial exploration, building graph structure"
    phase_boundaries:
      early_max_nodes: 3
      mid_max_nodes: 8
    signal_weights:
      explore_situation: 1.5
      probe_alternatives: 1.2
      dig_motivation: 0.5
      validate_outcome: 0.2
      uncover_obstacles: 0.3

  mid:
    description: "Building depth and connections"
    phase_boundaries:
      early_max_nodes: 3
      mid_max_nodes: 8
    signal_weights:
      dig_motivation: 1.3
      probe_alternatives: 1.0
      uncover_obstacles: 1.0
      explore_situation: 0.8
      validate_outcome: 0.5

  late:
    description: "Validation and verification"
    phase_boundaries:
      early_max_nodes: 3
      mid_max_nodes: 8
    signal_weights:
      validate_outcome: 1.5
      uncover_obstacles: 1.2
      dig_motivation: 0.5
      explore_situation: 0.3
